# Edge Dify 工作流扩展使用说明

## 功能简介

本扩展可将当前网页信息（标题、URL、正文、选中文本等）一键发送到 Dify 服务器的“工作流”进行自动化处理。适用于网页内容采集、自动摘要、智能分析等场景。

---

## 快速开始

1. **安装扩展**  
   Edge/Chrome 浏览器加载本扩展（开发者模式下“加载已解压的扩展”）。

2. **配置 Dify 工作流**  
   - 点击扩展图标，进入“配置...”页面。
   - 新增工作流，填写：
     - 名称（自定义）
     - 服务器URL（如 `https://your-dify-server.com`，无需斜杠结尾）
     - API Key（Dify 后台获取，需有调用工作流权限）
   - 注意：**必须是 Dify 的“工作流”而非“聊天流”**，否则无法正常调用。

3. **设置输入参数**  
   - 在“输入变量名”处填写 Dify 工作流的输入参数名（如 `webinfo`），需与 Dify 工作流节点的输入参数一致。
   - 可勾选需要采集的网页信息项（标题、URL、正文、选中文本）。

4. **Dify 端工作流配置要求**  
   - 工作流需有一个输入参数（如 `webinfo`），类型建议为字符串。
   - 工作流入口节点必须为“工作流”类型，不能是“聊天流”。
   - 可在 Dify 后台新建工作流，添加所需节点，并设置输入参数名与扩展一致。

---

## 使用方法

1. 打开任意网页，点击扩展图标。
2. 选择要调用的工作流，点击“发送当前页面到 Dify”。
3. 页面信息将以如下格式发送到 Dify 工作流：

   ```
   标题: <网页标题>
   URL: <网页地址>
   选中文本: <用户选中的文本>
   正文内容: <网页正文前2000字>
   ```

   - 发送内容会作为你设置的输入参数（如 `webinfo`）传递给 Dify 工作流。

4. Dify 工作流处理完成后，可在 Dify 后台查看结果。

---

## 常见问题

- **Q: 为什么有些页面提示“当前页面不支持扩展采集”？**  
  A: 某些网站由于安全策略或技术限制，扩展无法注入脚本，无法采集信息。

- **Q: Dify 返回 401/403/404/500 等错误？**  
  A: 请检查 API Key、服务器 URL、工作流配置及输入参数名是否正确。

- **Q: 工作流未收到参数？**  
  A: 请确保 Dify 工作流入口节点为“工作流”，且输入参数名与扩展设置一致。

---

## 技术细节

- 扩展通过 Dify API `/v1/workflows/run` 发送 POST 请求，body 格式如下：

  ```json
  {
    "inputs": {
      "webinfo": "标题: ...\nURL: ...\n选中文本: ...\n正文内容: ..."
    },
    "user": "edge-extension-user"
  }
  ```

- 你可在 Dify 工作流节点内直接引用 `${inputs.webinfo}` 进行处理。

---

## 建议

- 推荐为每个采集场景单独新建 Dify 工作流，便于后续维护和扩展。
- 如需采集更多字段，可在 options 页面自定义采集项和参数名。

---

如有更多问题，欢迎反馈或提交 issue。
